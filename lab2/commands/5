WITH RECURSIVE FriendChain AS (
    -- Base case: start with Anas
    SELECT
        U.UserID AS user_id,
        U.name AS name,
        ARRAY[U.UserID] AS visited,
        1 AS depth
    FROM
        Users U
    WHERE
        U.UserID = 20

    UNION ALL

    -- Recursive case: find friends of the current user
    SELECT
        F.FriendID AS user_id,
        U.name AS name,
        visited || F.FriendID AS visited,
        depth + 1 AS depth
    FROM
        FriendChain FC
    JOIN
        Friend F ON F.UserID = FC.user_id
    JOIN
        Users U ON U.UserID = F.FriendID
    WHERE
        NOT F.FriendID = ANY(visited)  -- Avoid cycles
)

SELECT
    name,
    user_id,
    LEAD(user_id) OVER (ORDER BY depth) AS friend_id
FROM
    FriendChain
ORDER BY
    depth;
